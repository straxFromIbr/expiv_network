# 1. 目的
インターネットの基本的な機能を提供するプログラムのシステムを理解し、
実機によりLAN内でどのようにサーバを構築するか学ぶ。

# 2. インターネットとさまざまなサーバプログラム

## 2.1 TCP/IPとクライアント／サーバモデル
インターネットとは、ケーブルや電話線、光ファイバーなどのさまざまなメディアで
接続された、多数のコンピュータを含む地球規模のネットワークである。
通信線上のデータの形式は通常TCP/IPと呼ばれるプロトコルにより定義される。
そのプロトコルにより、異なるLAN間のコンピュータが異なる媒体を通じて通信することが
可能となる。

それぞれのコンピュータはTCP/IP上の他のコンピュータに対し同じ階層にあり、
以下に述べる役割のいずれかを担う。
- データを要求し、受け取るコンピュータ
- 要求に応じデータを送るコンピュータ

前者は *クライアント* とよばれ、Eメールの閲覧やブラウザなどプログラムが実行される。
校舎は *サーバ* とよばれ、常に起動し続けクライアントの要求に応じデータを送信する。
どちらのコンピュータもハードウェアのアーキテクチャは同じであり、それらのソフトウェア
により異なる役割を担う。

## 2.2 インターネット上の主なサーバの機能
インターネット上で用いられるサーバの機能は、EメールやWebのように
ユーザーに直接提供されるものだけではない。たとえばドメイン名などインターネット自身
を保守する機能もある。以降のセクションでは4つのサーバの機能について述べる。

### 2.2.1 ドメインネームサーバ（DNS）
TCP/IPネットワークに接続されるそれぞれのコンピュータは一意に識別するための
IPアドレスを持つ。それは数字のみにより構成されるため人間よりも機械が処理するための
ものである。
インターネット上では、それぞれのサーバコンピュータはIPアドレスの対応づけられる
独自の文字列からなる名前を持ち、それは人間に使用される。
加えてローカルネットワークグループにも独自の文字列の名前が割り当てられる。
それによりユーザーはその組織や属するネットワークを識別できる。
これらの文字列は通常 *ドメイン名* と呼ばれる。

たとえば、次に茨城高専の公式Webサイト、`http://www.ibaraki-ct.ac.jp/`を挙げる。
この文字列中の`www.ibaraki-ct.ac.jp`がサーバ名なのだが実のところこれは`164.46.32.80`
に割り当てられている。しかしこのIPアドレスはユーザーにとって不便であるため、`www`が
コンピュータ名に、`ibaraki-ct.ac.jp`は他の組織と区別するため、茨城高専に割り当てられている。

ドメイン名のデータは1つでなく、重複した対応付けのテーブルが作成されるのを
防ぐために複数の組織により管理されている。たとえば茨城高専が`ibaraki-ct.ac.jp`を
管理するように、1つの組織は1つのグループのドメインを管理し、その組織が自律的に
グループに属するコンピュータや下位グループの名前を定義する。すなわち、対応テーブル
は分散しておりそれらはDNS（Domain Name ServerまたはDomain Name System）により管理される。

特定の組織のDNSを自分で管理する場合、その組織はコンピュータとIPアドレスの
対応表を管理し、その組織を示すドメイン名を組織であることを示す。
DNSはグループ分けするだけでなく、グループ内の下位クラスと上位クラスの関連付けのため
データも保持している。それはまたEメール送信のためのデータも保持する。なぜなら
ドメイン名はEメールアドレスにも使用されるためである。

### 2.2.2 Dynamic Host Configuration Protocol (DHCP)
DHCPはTCP/IPネットワーク上でコンピュータどうしが通信されるためにデータを自動的に
割り振るプロトコルである。Microsoft Windowsのように現代のOSを採用するクライアントは
標準でDHCPを使用し、接続しているネットワーク上に存在するDHCPサーバから必要な
設定データを自動的に取得する。

クライアントはDHCPサーバから設定データを取得すれば、TCP/IPネットワーク上で通信可能となる。つまりクライアントはその設定データを使用しないで済む他の通信方法を使用する
必要がある。そこでブロードキャストがDHCPサーバとの通信で使用される。

### 2.2.3 Simple Mail Transfer Protocol (SMTP)
SMTPはコンピュータ間でEメールを送信、受信、そして転送するプロトコルである。
SMTPサーバがEメールを受け取り次第、そのプログラムはメールをメールボックスに
保管するか、 メールアドレスを確認することで他の適切なコンピュータに転送する。

たとえば茨城高専のメールアドレスの様式は次のように示される。

`st00000@ece.ibaraki-ct.ac.jp`

アドレスに`ibaraki-ct.ac.jp`が含まれる場合、茨城高専のメールサーバがそれを受け取る。
そのプログラムはメールボックスに保管せず、高専内の別の内部SMTPサーバに転送する。
内部サーバは文字列`ece`を認識し、電子情報工学科のために用意されたSMTPサーバに
転送される。そのSMTPサーバがメールボックスにメールを保存する。

一般的に、クライアントがメールを送信する際は上記の手順とは逆にメールが転送される。
もしメールが学科内部に向けたものであれば外部のサーバには転送されず学科内のサーバ
に直接転送される。

DNSはメールがどこに送られるべきか認識するためにアドレスを管理する。Post Office Protocol （POP）はユーザーによりメールボックスからメールを取得するプロトコルである。

### 2.2.4 HypterText Transfer Protocol (HTTP)

HTTPはHTMLドキュメントや他のファイルを扱うプロトコルである。これはWorld Wide Web
を実現するために、さまざまな属性（時刻データやアクセス制限など）を付加してファイル
を転送するのに特化したプロトコルの1つである。

たとえば次に示す茨城高専の公式WebサイトのURL（DNSと同じである）を例に挙げる。

`http://www.ibaraki-ct.ac.jp`

ブラウザ（またはHTTPクライアント）が上記のURLにアクセスしたとき、ブラウザは
`www.ibaraki-ct.ac.jp`というコンピュータにHTTPで通信する。HTTPサーバ（またはWeb
サーバ）はアクセスしてきたHTTPクライアントにトップページのHTTPドキュメントを送信
する。
クライアントはHTTPドキュメントを解析し、そのドキュメント内が画像や音声ファイルなど
の他のデータの属性を含む場合、それらのデータをサーバに要求する。サーバはドキュメ
ントと同じように必要なファイルを転送する。

結果として、ユーザーが1つのURLのみにアクセスしたとしても、HTTPクライアントとサー
バは大量のファイルを転送するために何度も通信する。またWebサーバはインターネット
など世界中のコンピュータからアクセスがある。加えてサーバは常に稼働していなくてはな
らない。事実、運用中のHTTPサーバは大量のアクセスを処理するために多くのデバイスを持つ。


--------

# サーバプログラム
## 1. BIND (named)
BINDはUNIXに標準で含まれているDNSサーバプログラムである。BINDの設定ファイルは
`named.conf`であり、ゾーンファイルと呼ばれるIPアドレスとコンピュータ名の対応を定義
するファイル群が別途作成される。ゾーンファイルの名前は`named.conf`内で定義される。

ゾーンはドメインごとに定義され、2種類のゾーンファイルが割くせされる。
1つはドメイン名からIPアドレスを取得するため、もう1つはIPアドレスからドメイン名
を取得するためのものである。今実験においては次の項目を設定する：
IPアドレスを取得するためのレコード、ドメイン名を取得するためのPTRレコード、そして
メールサーバの属性を取得するためのMXレコードである。

DNSサーバはクライアントコンピュータがDNSサーバを指定したときのみ使用される。
その指定は手作業のみならずDHCPサーバによってもできる。今テーマではDHCPサーバにより行う。

## 2. DHCP(dhcpd)
Internet Systems Consortium IncはDHCPサーバプログラムをOSSとして提供する。またそれは
UNIXに標準で含まれる。設定ファイルは`dhcpd.conf`でありさまざまなデータを定義する。

また、DHCPサーバプログラムはネットワークハードウェア固有のIDであるMACアドレスを利用し、
コンピュータにIPアドレスを割り当てる。今テーマでは、指定したIPアドレスの範囲の中から
クライアントの要求に応じ、DHCPサーバがアドレスを割り振るように設定する。

##  3. Postfix
PostfixはUNIX用の著名なSMTPサーバソフトウェアパッケージの1つである。
それは多くの便利な機能があるのみならず、他のSMTPソフトウェアに比べセットアップが
容易になるような設定スキーマを持つ。さらに特定の属性により、メールをメールボックスに
保持したりあるいは拒否する機能を持つ。

今テーマではWindowsコンピュータから送信されたメールを受け取るテストに必要な最小限の設定
のみ行う。ユーザーがメールボックスからメールを取得するPOPサーバはサポートされない。



## 4. Apache HTTP Server (httpd)
Apache HTTPサーバはインターネット上で非常によく使われるソフトウェアである。
httpdは通常、大量のクライアントからのリクエストを並行に処理するために複数のプロセス
が実行される。

Apache HTTP Serverの設定ファイルは`httpd.conf`であり、公開設定やアクセス制限などの設定
が含まれる。それにより1台のコンピュータが複数のWebサーバとして振る舞うことができる。
今テーマでは単一のサーバを提供するので最小限の設定のみしか必要としない。




















