
# Installation and Setup for Internet Servers 
> Server Constructions on UNIX Operating System 


# 目的
インターネットに基本的機能を提供するシステムを理解し、実機によるLANでどのようにサーバを構築するか学ぶ。
# サーバの設定事項

以下の表に示すようにドメイン名とホスト名を定めた。
それぞれのサーバの名前は麻雀の牌の種類（萬子、筒子、索子、字牌）から命名した。


## ネットワーク

|   ドメイン名 | ネットワークアドレス | サブネットマスク |
|-------------:|---------------------:|-----------------:|
| `mahjongnet` |        `192.168.1.0` |  `255.255.255.0` |

## コンピュータ

|             | コンピュータ名 |    IPアドレス |
|:------------|---------------:|--------------:|
| DNS  Server |      `pinsdns` | `192.168.1.1` |
| DHCP Server |     `sousdhcp` | `192.168.1.2` |
| SMTP Server |     `wanssmtp` | `192.168.1.3` |
| HTTP Server |     `charhttp` | `192.168.1.4` |


## 担当箇所
私は2週目にDHCPサーバ（`sousdhcp`）とSMTPサーバ（`wanssmtp`）の設定を担当した。

### DHCPサーバの設定

`/etc/dhcpd.conf`ファイルに次のように記述した。

```
ddns-update-style ad-hoc;
option domain-name "mahjongnet";
option domain-name 192.168.1.1;

subnet 192.168.1.0 netmask 255.255.255.0 {
    option broadcast-address 192.168.1.255;
    option subnet-mask 255.255.255.0;
}

host D-0152 {
    hardware ethernet 00:26:18:4E:F0:BD;
    fixed-address 192.168.1.5;
}

host D-0148{
    hardware ethernet 00:26:18:4E:F0:B3;
    fixed-address 192.168.1.6;
}
```

また、割り当てたプライベートIPアドレスを記憶しておくためのデータベースファイルを
`/var/db/dhcpd.leases`に作成した。

加えて`/etc/rc.conf`中でOS起動時にDHCPdを起動するように、
`dhcpd=YES`を追記した。


最後に、`sousdhcp`によりLANに接続した2台のWindowsPC(`D-152`,`D-148`)に上記で設定したIPアドレスが
割り当てられていることを確認した。


### SMTPサーバの設定
`/etc/postfix/main.cf`ファイルに次を追記した。

```
myhostname = wanssmtp.mahjongnet
mydomain = mahjongnet
myorigin = $mydomain
inet_interfaces = all
mydestination = $myhostname, localhost.$mydomain, $mydomain
mynetworks = 192.168.1.0/24, 127.0.0.0/8
alias_maps = hash:/etc/mail/aliases
mail_spool_directory = /var/mail
```

また`/etc/postfix/master.cf`に次の行を追加した。

```
smtp    inet    n   -   n   -   -   smtpd
```

加えてOS起動時にpostfixが起動するように、`/etc/rc.conf`に次の行を追記した。

```
sendmail=NO
postfix=YES
```

最後にtelnetで自身の25番ポートに接続し、`wanssmtp`の一般ユーザーに向けてメールを
送信し、受信できていることを確認した。







# 調査と報告
## 調査報告事項1
> ドメイン名の対応を管理する少なくとも２つの組織を調べ、そのドメイン名を報告。

- JPRS（日本レジストリサービス）: `.jp`
    - 2002年にJPNICからJPドメインの登録管理業務を移管された。
- GMOドメインレジストリ : `.tokyo`
    - 2014年より`.nagoya`, `.yokohama`とともに地域名の一般トップレベルドメイン
    として新設された。

### 参考：
- [JPNICからJPRSへのJPドメイン名登録管理業務の移管について](https://www.nic.ad.jp/ja/dom/ikan.html)
- [https://hello.tokyo/](https://hello.tokyo/)

---
## 調査報告事項2
> DHCPサーバとの通信に用いられるブロードキャスト方式についてその利点と欠点を調べよ。

ブロードキャストとは、同一のネットワークに接続されたすべての機器にデータを一斉送信する機能である。
ブロードキャスト通信は、ネットワーク内のすべての機器と個別に一対一で通信するのに比べ、流れるデータ量が少ない点、自身のIPアドレスを持たない場合でもブロードキャスト通信によりDHCPサーバからデータを得られる点が優れている。
一方上述したようにブロードキャストはネットワーク内の全ての機器がデータを受信するが、例えばDHCPによりIPアドレスを取得する場合、送信されたデータはDHCPサーバ以外にとって不要な情報であるため、無関係な機器にとっては余分な負荷となってしまうことが欠点である。

### 参考
- [すべての相手に一斉送信、必殺技の「ブロードキャスト」を完全図解](https://xtech.nikkei.com/atcl/nxt/column/18/00780/062000008/)
- [ブロードキャスト](https://www.wdic.org/w/WDIC/%25E3%2583%2596%25E3%2583%25AD%25E3%2583%25BC%25E3%2583%2589%25E3%2582%25AD%25E3%2583%25A3%25E3%2582%25B9%25E3%2583%2588)

---
## 調査報告事項3
> SMTPサーバを組織内部のメール転送を執り行うサーバと、外部から転送されたメールを扱う外部におくサーバに分けることで、外部から転送されたメールに対しアンチウイルスサービスを適用できる。これらのサーバに対して適用可能である他の効果について調べろ。


外部との通信を行うメールサーバを組織内のネットワークに置いた場合、そのメールサーバを踏み台とした攻撃が為される場合がある。外部との通信を行うサーバを内部向けのものと分離することで踏み台とされるリスクを低減できる。

---
## 調査報告事項4
> HTTPサーバにおいて大量のアクセスを処理するための機構を2つ調べ、その利点と欠点を述べよ

- マルチプロセス
    - リクエストに応じプロセスをクライアントごとに新たにプロセスをフォークして、それらがレスポンスを返すしくみである。各プロセスが独立していることがメリットである一方、同時接続数が増えるに従い消費するメモリや処理のオーバーヘッドが増大するデメリットがある。

- イベント駆動
    - 1つのシングルスレッドプロセスが、複数のリクエストの対応を独立したイベントとして処理する。そのため、マルチプロセス処理で発生するようなオーバーヘッドが発生しないという利点がある。一方シングルスレッドで動作するため高い負荷がかかる処理を必要とするサービスには不向きである。

---
# 感想

1週目でDNSの設定をした際、変更するべきでない箇所を誤って編集してしまい、
復帰するために隣りのコンピュータ内の設定ファイルを参照した。
同種のOSを搭載したコンピュータが近くになかったとしてもインターネット
経由でデフォルトの設定ファイルを入手できるとは言え、変更前のファイルを
何らかの方法でバックアップしておくべきだと強く感じた。


また、今回の実験で初めてNetBSD OSに触れたが、シェルや、
エディタ、ページャなどのツールの使い勝手はmacOSとほとんど変わらず、
POSIX規格の偉大さをあらためて実感した。
